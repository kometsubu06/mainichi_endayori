<div class="space-y-4">
  <!-- 戻る -->
  <div>
    <%= link_to "← お知らせ一覧へ", notices_path,
          class: "inline-flex items-center text-sm text-sky-700 hover:underline" %>
  </div>

  <!-- タイトル＋バッジ -->
  <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
    <h1 class="text-lg md:text-xl font-bold text-slate-900">
      <%= @notice.title %>
      <%# 既読/未読バッジ（@unread を使うならここで） %>
      <% if defined?(@unread) && @unread == false %>
        <span class="ml-2 inline-flex items-center rounded-full px-2 py-0.5 bg-slate-200 text-slate-700 text-xs">既読</span>
      <% end %>
      <% if @notice.respond_to?(:require_submission) && @notice.require_submission %>
        <span class="ml-2 inline-flex items-center rounded-full px-2 py-0.5 bg-amber-50 text-amber-700 border border-amber-200 text-xs">提出あり</span>
      <% end %>
    </h1>

    <!-- 本文 -->
    <div class="mt-3 leading-relaxed text-slate-800 whitespace-pre-wrap break-words">
      <%= simple_format(@notice.body.to_s, {}, sanitize: false) %>
    </div>
    <% if @notice.images.attached? %>
      <div class="mt-4 grid grid-cols-2 md:grid-cols-3 gap-3">
        <% @notice.images.each do |img| %>
          <%= image_tag img.variant(resize_to_fit: [1200, 800]).processed,
                class: "w-full rounded-lg border object-cover" %>
        <% end %>
      </div>
    <% end %>
    <!-- メタ情報 -->
    <ul class="mt-4 text-sm text-slate-600 space-y-1">
      <% if @notice.due_on.present? %>
        <li>締切：<%= @notice.due_on.strftime("%-m月%-d日") %></li>
      <% end %>
      <li>提出の要否：<%= @notice.require_submission ? "必要" : "不要" %></li>
      <li>掲載日時：<%= (@notice.published_at || @notice.created_at).in_time_zone.strftime("%-m月%-d日 %H:%M") %></li>
    </ul>
  </div>
</div>

<%# 未読なら「既読にする」ボタンを表示（Turboでバッジだけ置き換え） %>
<% if @unread %>
  <div style="margin-top:1rem;">
    <%= button_to '既読にする',
          read_notice_path(@notice),
          method: :post,
          data: { turbo: true },
          params: (@notice.has_attribute?(:lock_version) ? { lock_version: @notice.lock_version } : {}),
          class: 'btn' %>
  </div>
<% else %>
  <p style="margin-top:1rem; color:#666;">このお知らせは既読です。</p>
<% end %>
